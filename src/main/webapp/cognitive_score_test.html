<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cognitive Score Test</title>
  <link rel="stylesheet" href="/assets/theme.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      color: #0d1b4a;
      background:
        linear-gradient(140deg, rgba(7, 27, 84, 0.7), rgba(95, 57, 180, 0.6)),
        url('/assets/IMAGES/kids.jpg') no-repeat center center/cover;
      min-height: 100vh;
    }
    .page-shell {
      max-width: 760px;
      margin: 50px auto;
      background: rgba(255, 255, 255, 0.94);
      border: 1px solid #d6e2ff;
      border-radius: 18px;
      box-shadow: 0 16px 36px rgba(11, 24, 74, 0.26);
      padding: 28px;
    }
    .question-title { color: #172a65; font-weight: 700; }
    .animal-card img { height: 170px; object-fit: cover; border-radius: 12px; width: 100%; }
    .helper-text { color: #4e5e8f; font-size: 0.95rem; }
  </style>
</head>
<body>
  <button class="global-back-btn" type="button" onclick="window.location.href='/home'">← Back</button>
  <div class="page-shell">
    <h1 class="text-center mb-4">Cognitive Score Test</h1>

    <div id="taskContainer">
      <div id="memoryTest" class="mb-4">
        <h3 class="question-title">Memory Test</h3>
        <p class="helper-text mb-1">Remember these words:</p>
        <p class="fw-semibold" id="memoryWords"></p>
        <input type="text" id="memoryInput" class="form-control" placeholder="Type the words you remember" required>
      </div>

      <div id="attentionTest" class="mb-4" style="display: none;">
        <h3 class="question-title">Attention Test</h3>
        <p class="helper-text">Find the animals in the images below:</p>
        <div class="row" id="animalImages"></div>
        <input type="text" id="attentionInput" class="form-control mt-3" placeholder="Type the animals you found (comma separated)" required>
      </div>

      <div id="problemSolvingTest" class="mb-4" style="display: none;">
        <h3 class="question-title">Problem-Solving Test</h3>
        <p id="problemQuestion" class="helper-text">Loading question...</p>
        <input type="text" id="problemInput" class="form-control" placeholder="Your answer" required>
      </div>

      <div id="languageTest" class="mb-4" style="display: none;">
        <h3 class="question-title">Language Test</h3>
        <p id="languageQuestion" class="helper-text">Loading question...</p>
        <input type="text" id="languageInput" class="form-control" placeholder="Your answer" required>
      </div>
    </div>

    <button id="submitBtn" class="btn btn-primary w-100">Submit &amp; Next</button>
    <div id="result" class="mt-3 text-center fw-semibold"></div>
    <button id="finishTestBtn" class="btn btn-success w-100 mt-3" style="display: none;">Finish Test</button>
  </div>

  <script>
    const memoryWordSets = [
      ["apple", "banana", "orange"],
      ["river", "planet", "mirror"],
      ["garden", "pencil", "rocket"],
      ["camera", "window", "tiger"]
    ];

    const imageLinks = [
      { label: "cat", url: "https://upload.wikimedia.org/wikipedia/commons/4/4d/Cat_November_2010-1a.jpg" },
      { label: "elephant", url: "https://upload.wikimedia.org/wikipedia/commons/3/37/African_Bush_Elephant.jpg" },
      { label: "dog", url: "https://images.unsplash.com/photo-1517849845537-4d257902454a?auto=format&fit=crop&w=500&q=80" },
      { label: "horse", url: "https://images.unsplash.com/photo-1553284965-83fd3e82fa5a?auto=format&fit=crop&w=500&q=80" },
      { label: "lion", url: "https://images.unsplash.com/photo-1546182990-dffeafbe841d?auto=format&fit=crop&w=500&q=80" },
      { label: "rabbit", url: "https://images.unsplash.com/photo-1585110396000-c9ffd4e4b308?auto=format&fit=crop&w=500&q=80" }
    ];

    const problemQuestions = [
      { question: "If you have 3 apples and eat 1, how many are left?", answer: "2" },
      { question: "What is 6 + 7?", answer: "13" },
      { question: "A farmer has 10 sheep and 3 run away. How many remain?", answer: "7" },
      { question: "What is 9 - 4?", answer: "5" }
    ];

    const languageQuestions = [
      { question: 'Complete: "The cat ___ on the mat."', answer: "sat" },
      { question: 'Fill in: "She ___ a beautiful song."', answer: "sang" },
      { question: 'Complete: "Birds ___ in the sky."', answer: "fly" }
    ];

    function pickRandom(list, count = 1) {
      const cloned = [...list];
      for (let i = cloned.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [cloned[i], cloned[j]] = [cloned[j], cloned[i]];
      }
      return cloned.slice(0, count);
    }

    const tests = [
      { id: 'memoryTest', inputId: 'memoryInput', correctAnswer: '' },
      { id: 'attentionTest', inputId: 'attentionInput', correctAnswer: '' },
      { id: 'problemSolvingTest', inputId: 'problemInput', correctAnswer: '' },
      { id: 'languageTest', inputId: 'languageInput', correctAnswer: '' }
    ];

    let currentTestIndex = 0;
    let totalScore = 0;

    function loadMemoryChallenge() {
      const words = pickRandom(memoryWordSets, 1)[0];
      document.getElementById('memoryWords').textContent = words.join(', ');
      tests[0].correctAnswer = words.join(', ');
    }

    function displayRandomImages() {
      const selected = pickRandom(imageLinks, 3);
      document.getElementById('animalImages').innerHTML = selected
        .map((item) => `<div class="col-md-4 mb-3 animal-card"><img src="${item.url}" alt="${item.label}" loading="lazy"></div>`)
        .join('');
      tests[1].correctAnswer = selected.map((item) => item.label).sort().join(',');
    }

    function loadRandomQuestion() {
      const selected = pickRandom(problemQuestions, 1)[0];
      document.getElementById('problemQuestion').innerText = selected.question;
      tests[2].correctAnswer = selected.answer.toLowerCase();
    }

    function loadRandomLanguageQuestion() {
      const selected = pickRandom(languageQuestions, 1)[0];
      document.getElementById('languageQuestion').innerText = selected.question;
      tests[3].correctAnswer = selected.answer.toLowerCase();
    }

    function initializeTests() {
      loadMemoryChallenge();
      displayRandomImages();
      loadRandomQuestion();
      loadRandomLanguageQuestion();
    }

    document.addEventListener("DOMContentLoaded", initializeTests);

    document.getElementById('submitBtn').addEventListener('click', function() {
      const currentTest = tests[currentTestIndex];
      const input = document.getElementById(currentTest.inputId);
      const userAnswer = input.value.trim().toLowerCase();
      const correctAnswer = currentTest.correctAnswer;

      let isCorrect = false;
      if (currentTest.id === 'attentionTest') {
        const normalizedUser = userAnswer.split(',').map((x) => x.trim()).filter(Boolean).sort().join(',');
        isCorrect = normalizedUser === correctAnswer;
      } else {
        isCorrect = userAnswer === correctAnswer;
      }

      if (isCorrect) {
        totalScore += 25;
        document.getElementById('result').textContent = "✅ Correct!";
      } else {
        document.getElementById('result').textContent = `❌ Incorrect. Correct answer: ${currentTest.correctAnswer}`;
      }

      document.getElementById(currentTest.id).style.display = "none";
      input.value = "";
      currentTestIndex++;

      if (currentTestIndex < tests.length) {
        document.getElementById(tests[currentTestIndex].id).style.display = "block";
      } else {
        document.getElementById('submitBtn').style.display = "none";
        document.getElementById('result').textContent = `Your Cognitive Score: ${totalScore}%`;
        sessionStorage.setItem('cognitive_score', totalScore);
        document.getElementById('finishTestBtn').style.display = "block";
      }
    });

    document.getElementById('finishTestBtn').addEventListener('click', function() {
      window.location.href = '/dyslexia-prediction';
    });
  </script>
</body>
</html>
