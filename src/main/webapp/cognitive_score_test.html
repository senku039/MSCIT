<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cognitive Score Test</title>
  <link rel="stylesheet" href="/theme.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      color: #0d1b4a;
      background:
        linear-gradient(140deg, rgba(7, 27, 84, 0.7), rgba(95, 57, 180, 0.6)),
        url('/IMAGES/kids.jpg') no-repeat center center/cover;
      min-height: 100vh;
    }
    .page-shell {
      max-width: 980px;
      margin: 50px auto;
      background: rgba(255, 255, 255, 0.94);
      border: 1px solid #d6e2ff;
      border-radius: 18px;
      box-shadow: 0 16px 36px rgba(11, 24, 74, 0.26);
      padding: 28px;
    }
    .question-title { color: #172a65; font-weight: 700; }
    .helper-text { color: #4e5e8f; font-size: 0.95rem; }
    .sequence-box {
      min-height: 120px;
      border: 1px solid #cfdbfb;
      border-radius: 12px;
      background: #f5f8ff;
      display: grid;
      place-items: center;
      margin-bottom: 10px;
      font-size: 1.8rem;
      font-weight: 700;
      color: #1f3a83;
    }
  </style>
</head>
<body>
  <button class="global-back-btn" type="button" onclick="window.location.href='index.html'">← Back</button>
  <div class="page-shell">
    <h1 class="text-center mb-4">Cognitive Score Test</h1>

    <div id="taskContainer">
      <div id="memoryTest" class="mb-4">
        <h3 class="question-title">1) Memory Recall</h3>
        <p class="helper-text mb-1">Remember these words:</p>
        <p class="fw-semibold" id="memoryWords"></p>
        <input type="text" id="memoryInput" class="form-control" placeholder="Type all words in order (comma separated)" required>
      </div>

      <div id="attentionTest" class="mb-4" style="display: none;">
        <h3 class="question-title">2) Which item came first?</h3>
        <p class="helper-text">Press start, watch the sequence, and type the first item shown.</p>
        <div class="sequence-box" id="sequenceBox">Ready</div>
        <button id="playSequenceBtn" class="btn btn-outline-primary mb-2" type="button">Play Sequence</button>
        <input type="text" id="attentionInput" class="form-control" placeholder="Type the first item" required>
      </div>

      <div id="problemSolvingTest" class="mb-4" style="display: none;">
        <h3 class="question-title">3) Problem-Solving</h3>
        <p id="problemQuestion" class="helper-text">Loading question...</p>
        <input type="text" id="problemInput" class="form-control" placeholder="Your answer" required>
      </div>

      <div id="languageTest" class="mb-4" style="display: none;">
        <h3 class="question-title">4) Language Completion</h3>
        <p id="languageQuestion" class="helper-text">Loading question...</p>
        <input type="text" id="languageInput" class="form-control" placeholder="Your answer" required>
      </div>

      <div id="patternTest" class="mb-4" style="display: none;">
        <h3 class="question-title">5) Pattern Challenge</h3>
        <p id="patternQuestion" class="helper-text">Loading question...</p>
        <input type="text" id="patternInput" class="form-control" placeholder="Type the next value" required>
      </div>
    </div>

    <button id="submitBtn" class="btn btn-primary w-100">Submit &amp; Next</button>
    <div id="result" class="mt-3 text-center fw-semibold"></div>
    <button id="finishTestBtn" class="btn btn-success w-100 mt-3" style="display: none;">Finish Test</button>
  </div>

  <script>
    const memoryWordSets = [
      ["apple", "banana", "orange", "river"],
      ["garden", "pencil", "rocket", "tiger"],
      ["camera", "window", "planet", "mirror"],
      ["forest", "school", "yellow", "bridge"]
    ];

    const attentionItems = ["Cat", "Sun", "Car", "Tree", "Moon", "Book", "Fish", "Clock"];
    let currentSequence = [];

    const problemQuestions = [
      { question: "If 3 notebooks cost 90, how much do 5 notebooks cost?", answer: "150" },
      { question: "What is 36 divided by 6?", answer: "6" },
      { question: "A train has 48 seats and 19 are filled. How many are empty?", answer: "29" },
      { question: "What is 14 + 9?", answer: "23" }
    ];

    const languageQuestions = [
      { question: 'Complete: "The child ___ quickly to school."', answer: "ran" },
      { question: 'Fill in: "They ___ a new game yesterday."', answer: "played" },
      { question: 'Complete: "Birds ___ in the sky."', answer: "fly" }
    ];

    const patternQuestions = [
      { question: "2, 4, 8, 16, __", answer: "32" },
      { question: "5, 10, 15, 20, __", answer: "25" },
      { question: "1, 1, 2, 3, 5, __", answer: "8" },
      { question: "9, 7, 5, 3, __", answer: "1" }
    ];

    function pickRandom(list, count = 1) {
      const cloned = [...list];
      for (let i = cloned.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [cloned[i], cloned[j]] = [cloned[j], cloned[i]];
      }
      return cloned.slice(0, count);
    }

    const tests = [
      { id: 'memoryTest', inputId: 'memoryInput', correctAnswer: '', weight: 20 },
      { id: 'attentionTest', inputId: 'attentionInput', correctAnswer: '', weight: 20 },
      { id: 'problemSolvingTest', inputId: 'problemInput', correctAnswer: '', weight: 20 },
      { id: 'languageTest', inputId: 'languageInput', correctAnswer: '', weight: 20 },
      { id: 'patternTest', inputId: 'patternInput', correctAnswer: '', weight: 20 }
    ];

    let currentTestIndex = 0;
    let totalScore = 0;

    function loadMemoryChallenge() {
      const words = pickRandom(memoryWordSets, 1)[0];
      document.getElementById('memoryWords').textContent = words.join(', ');
      tests[0].correctAnswer = words.join(',').toLowerCase();
    }

    function loadAttentionChallenge() {
      currentSequence = pickRandom(attentionItems, 4);
      tests[1].correctAnswer = currentSequence[0].toLowerCase();
      document.getElementById('sequenceBox').textContent = 'Ready';
    }

    function playSequence() {
      const box = document.getElementById('sequenceBox');
      let i = 0;
      box.textContent = '...';
      const timer = setInterval(() => {
        if (i >= currentSequence.length) {
          clearInterval(timer);
          box.textContent = 'Type the first item now';
          return;
        }
        box.textContent = currentSequence[i];
        i += 1;
      }, 700);
    }

    function loadRandomQuestion() {
      const selected = pickRandom(problemQuestions, 1)[0];
      document.getElementById('problemQuestion').innerText = selected.question;
      tests[2].correctAnswer = selected.answer.toLowerCase();
    }

    function loadRandomLanguageQuestion() {
      const selected = pickRandom(languageQuestions, 1)[0];
      document.getElementById('languageQuestion').innerText = selected.question;
      tests[3].correctAnswer = selected.answer.toLowerCase();
    }

    function loadPatternQuestion() {
      const selected = pickRandom(patternQuestions, 1)[0];
      document.getElementById('patternQuestion').innerText = selected.question;
      tests[4].correctAnswer = selected.answer.toLowerCase();
    }

    function initializeTests() {
      loadMemoryChallenge();
      loadAttentionChallenge();
      loadRandomQuestion();
      loadRandomLanguageQuestion();
      loadPatternQuestion();
    }

    document.getElementById('playSequenceBtn').addEventListener('click', playSequence);
    document.addEventListener("DOMContentLoaded", initializeTests);

    document.getElementById('submitBtn').addEventListener('click', function() {
      const currentTest = tests[currentTestIndex];
      const input = document.getElementById(currentTest.inputId);
      const userAnswer = input.value.trim().toLowerCase();
      const correctAnswer = currentTest.correctAnswer;

      if (!userAnswer) {
        document.getElementById('result').textContent = 'Please enter an answer before continuing.';
        return;
      }

      let isCorrect = false;
      if (currentTest.id === 'memoryTest') {
        const normalized = userAnswer.split(',').map(x => x.trim()).filter(Boolean).join(',');
        isCorrect = normalized === correctAnswer;
      } else {
        isCorrect = userAnswer === correctAnswer;
      }

      if (isCorrect) {
        totalScore += currentTest.weight;
        document.getElementById('result').textContent = "✅ Correct!";
      } else {
        document.getElementById('result').textContent = `❌ Incorrect. Correct answer: ${currentTest.correctAnswer}`;
      }

      document.getElementById(currentTest.id).style.display = "none";
      input.value = "";
      currentTestIndex++;

      if (currentTestIndex < tests.length) {
        document.getElementById(tests[currentTestIndex].id).style.display = "block";
      } else {
        document.getElementById('submitBtn').style.display = "none";
        document.getElementById('result').textContent = `Your Cognitive Score: ${totalScore}%`;
        sessionStorage.setItem('cognitive_score', totalScore);
        document.getElementById('finishTestBtn').style.display = "block";
      }
    });

    document.getElementById('finishTestBtn').addEventListener('click', function() {
      window.location.href = '/dyslexia-prediction';
    });
  </script>
  <script src="/assets/enter-key-helper.js"></script>
</body>
</html>
