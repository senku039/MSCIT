<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prediction Result</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{margin:0;min-height:100vh;background:linear-gradient(145deg,rgba(11,26,75,.92),rgba(43,76,171,.88)),url('https://images.unsplash.com/photo-1517430816045-df4b7de11d1d?auto=format&fit=crop&w=1800&q=80') center/cover fixed;color:#122149}
    .wrap{max-width:1100px;margin:30px auto}
    .glass{background:rgba(255,255,255,.93);border:1px solid rgba(212,225,255,.9);border-radius:18px;box-shadow:0 18px 40px rgba(7,17,49,.28)}
    .badge-low{background:#198754}.badge-moderate{background:#fd7e14}.badge-high{background:#dc3545}
    .hero{background:linear-gradient(120deg,#edf3ff,#f5f8ff);border:1px solid #d7e4ff;border-radius:14px;padding:16px}
    .metric{background:#fff;border:1px solid #dbe6ff;border-radius:12px;padding:10px 14px}
  </style>
</head>
<body>
  <div class="wrap container">
    <a class="btn btn-light border mb-3" href="/dyslexia-prediction">‚Üê Back to Test</a>
    <div class="glass p-4 mb-3">
      <div class="hero">
        <h2 class="fw-bold">Dyslexia Prediction Result</h2>
        <p id="summary" class="mb-3"></p>
        <div class="d-flex flex-wrap gap-2 align-items-center">
          <span id="riskBadge" class="badge fs-6"></span>
          <span id="probability" class="metric fw-semibold"></span>
          <span id="modelProbability" class="metric text-muted"></span>
        </div>
      </div>
    </div>
    <div class="glass p-4 mb-3">
      <h4 class="fw-bold text-primary">Structured Analysis Table</h4>
      <div class="table-responsive"><table class="table table-bordered align-middle" id="analysisTable"><thead class="table-primary"><tr><th>Feature</th><th>Value</th><th>Expected</th><th>Status</th><th>Impact</th></tr></thead><tbody></tbody></table></div>
    </div>
    <div class="row g-3">
      <div class="col-md-6"><div class="glass p-4 h-100"><h4 class="fw-bold text-primary">Key Observations</h4><ul id="observations" class="mb-0"></ul></div></div>
      <div class="col-md-6"><div class="glass p-4 h-100"><h4 class="fw-bold text-primary">Recommendations</h4><ul id="recommendations" class="mb-0"></ul></div></div>
    </div>
  </div>
<script>
function decodePayload(){const params=new URLSearchParams(window.location.search);const d=params.get('data');if(!d)return null;try{return JSON.parse(atob(d.replace(/-/g,'+').replace(/_/g,'/')));}catch{return null;}}
const payload=decodePayload();
if(!payload){document.body.innerHTML='<div class="container mt-5"><div class="alert alert-warning">No result data found. Run the prediction test first.</div></div>';}else{
 document.getElementById('summary').textContent=payload.summary||'';
 document.getElementById('probability').textContent=`Screening Probability: ${payload.probability_percent ?? 0}%`;
 document.getElementById('modelProbability').textContent=`Model Probability: ${payload.model_probability_percent ?? payload.probability_percent ?? 0}%`;
 const b=document.getElementById('riskBadge');b.textContent=`${payload.risk_level||'Unknown'} Risk`;const r=(payload.risk_level||'').toLowerCase();b.classList.add(r.includes('high')?'badge-high':r.includes('moderate')?'badge-moderate':'badge-low');
 const tbody=document.querySelector('#analysisTable tbody');(payload.feature_analysis||[]).forEach(row=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${row.feature}</td><td>${row.value}</td><td>${row.expected_range}</td><td>${row.status}</td><td>${row.impact}</td>`;if(row.abnormal)tr.classList.add('table-danger');tbody.appendChild(tr);});
 (payload.observations||[]).forEach(i=>{const li=document.createElement('li');li.textContent=i;document.getElementById('observations').appendChild(li);});
 (payload.recommendations||[]).forEach(i=>{const li=document.createElement('li');li.textContent=i;document.getElementById('recommendations').appendChild(li);});
}
</script>
</body>
</html>
