<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>OCR Result</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{min-height:100vh;background:linear-gradient(160deg,rgba(14,30,89,.88),rgba(102,53,168,.78)),url('https://images.unsplash.com/photo-1456513080510-7bf3a84b82f8?auto=format&fit=crop&w=1700&q=80') center/cover fixed}
    .panel{border-radius:16px;border:1px solid #d9e4ff;box-shadow:0 14px 30px rgba(8,17,53,.24);background:rgba(255,255,255,.94)}
    pre{white-space:pre-wrap;border-radius:12px;background:#f7f9ff !important}
  </style>
</head>
<body>
<div class="container py-4" style="max-width:1050px;">
  <a class="btn btn-light border mb-3" href="/ocr-tool">‚Üê Back to OCR</a>
  <div class="card panel mb-3"><div class="card-body"><h2 class="fw-bold">OCR Result Dashboard</h2><p id="summary" class="mb-0 text-muted"></p></div></div>

  <div class="card panel mb-3"><div class="card-body">
    <h4 class="mb-3">Structured OCR Analysis</h4>
    <div class="table-responsive"><table class="table table-bordered"><thead class="table-primary"><tr><th>Metric</th><th>Value</th></tr></thead><tbody id="metricsBody"></tbody></table></div>
  </div></div>

  <div class="row g-3">
    <div class="col-md-4"><div class="card panel h-100"><div class="card-body"><h5>Extracted Text</h5><pre id="extracted" class="p-3"></pre></div></div></div>
    <div class="col-md-4"><div class="card panel h-100"><div class="card-body"><h5>Corrected Text</h5><pre id="corrected" class="p-3"></pre></div></div></div>
    <div class="col-md-4"><div class="card panel h-100"><div class="card-body"><h5>Simplified Text</h5><pre id="simplified" class="p-3"></pre></div></div></div>
  </div>
  <div class="row g-3 mt-1">
    <div class="col-md-6"><div class="card panel"><div class="card-body"><h4>Key Observations</h4><ul id="observations" class="mb-0"></ul></div></div></div>
    <div class="col-md-6"><div class="card panel"><div class="card-body"><h4>Recommendations</h4><ul id="recommendations" class="mb-0"></ul></div></div></div>
  </div>
</div>
<script>
function decodePayload(){const p=new URLSearchParams(window.location.search);const d=p.get('data');if(!d)return null;try{return JSON.parse(atob(d.replace(/-/g,'+').replace(/_/g,'/')));}catch{return null;}}
function textMetrics(text){const trimmed=(text||'').trim();if(!trimmed)return {chars:0,words:0,lines:0};return {chars:trimmed.length,words:trimmed.split(/\s+/).filter(Boolean).length,lines:trimmed.split(/\n+/).filter(Boolean).length};}
const payload=decodePayload();
if(!payload){document.body.innerHTML='<div class="container mt-5"><div class="alert alert-warning">No OCR data found.</div></div>';}else{
  const extracted=payload.extracted_text||'';const corrected=payload.corrected_text||'';const simplified=payload.simplified_text||'';
  document.getElementById('summary').textContent=payload.summary||'';
  document.getElementById('extracted').textContent=extracted;
  document.getElementById('corrected').textContent=corrected;
  document.getElementById('simplified').textContent=simplified;

  const m1=textMetrics(extracted), m2=textMetrics(corrected), m3=textMetrics(simplified);
  const rows=[['Extracted words',m1.words],['Corrected words',m2.words],['Simplified words',m3.words],['Extracted lines',m1.lines],['Character count',m1.chars],['Compression (simplified/extracted)',`${m1.words?Math.round((m3.words/m1.words)*100):0}%`]];
  const body=document.getElementById('metricsBody');
  rows.forEach(([k,v])=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${k}</td><td>${v}</td>`;body.appendChild(tr);});

  (payload.observations||[]).forEach(i=>{const li=document.createElement('li');li.textContent=i;document.getElementById('observations').appendChild(li);});
  (payload.recommendations||[]).forEach(i=>{const li=document.createElement('li');li.textContent=i;document.getElementById('recommendations').appendChild(li);});
}
</script>
</body>
</html>
