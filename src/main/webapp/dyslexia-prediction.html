<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dyslexia Prediction Test</title>
  <link rel="stylesheet" href="/theme.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background:
        linear-gradient(140deg, rgba(8, 24, 70, 0.7), rgba(64, 102, 196, 0.54)),
        url('/IMAGES/kids.jpg') no-repeat center center/cover;
    }
    .container {
      max-width: 700px;
      margin-top: 40px;
      background: rgba(255, 255, 255, 0.94);
      border-radius: 16px;
      border: 1px solid #d5e1ff;
      padding: 28px;
      box-shadow: 0 16px 34px rgba(7, 19, 56, 0.24);
    }
    .tip-box {
      background: #f3f7ff;
      border: 1px solid #d7e3ff;
      border-radius: 10px;
      padding: 10px 12px;
      color: #2b3a64;
      margin-bottom: 12px;
      font-size: .95rem;
    }
  </style>
</head>
<body>
  <button class="global-back-btn" type="button" onclick="window.location.href='/home'">← Back</button>
  <div class="container">
    <h1 class="text-center mb-2">Dyslexia Prediction Test</h1>
    <p class="text-center text-muted mb-3">Complete each mini-test. Question sets are randomized for better screening consistency.</p>
    <div class="tip-box" id="randomTip"></div>

    <div class="mb-4">
      <label for="attention" class="form-label">Attention Span</label>
      <input type="number" id="attention" class="form-control" placeholder="Enter attention span score" disabled>
      <button class="btn btn-primary mt-2" id="takeAttentionTest">Take Attention Span Test</button>
    </div>

    <div class="mb-4">
      <label for="cognitive" class="form-label">Cognitive Score</label>
      <input type="number" id="cognitive" class="form-control" placeholder="Enter cognitive score" disabled>
      <button class="btn btn-primary mt-2" id="takeCognitiveTest">Take Cognitive Test</button>
    </div>

    <div class="mb-4">
      <label for="reading_speed" class="form-label">Reading Speed</label>
      <input type="number" id="reading_speed" class="form-control" placeholder="Enter reading speed" disabled>
      <button class="btn btn-primary mt-2" id="takeReadingSpeedTest">Take Reading Speed Test</button>
    </div>

    <div class="mb-4">
      <label for="spelling_accuracy" class="form-label">Spelling Accuracy</label>
      <input type="number" id="spelling_accuracy" class="form-control" placeholder="Enter spelling accuracy" disabled>
      <button class="btn btn-primary mt-2" id="takeSpellingAccuracyTest">Take Spelling Accuracy Test</button>
    </div>

    <div class="mb-4">
      <label for="writing_errors" class="form-label">Writing Errors</label>
      <input type="number" id="writing_errors" class="form-control" placeholder="Enter writing errors" disabled>
      <button class="btn btn-primary mt-2" id="takeWritingErrorsTest">Take Writing Errors Test</button>
    </div>

    <div class="mb-4">
      <label for="phonemic_errors" class="form-label">Phonemic Awareness Errors</label>
      <input type="number" id="phonemic_errors" class="form-control" placeholder="Enter phonemic awareness errors" disabled>
      <button class="btn btn-primary mt-2" id="takePhonemicErrorsTest">Take Phonemic Awareness Test</button>
    </div>

    <div class="mb-4">
      <label for="response_time" class="form-label">Response Time</label>
      <input type="number" id="response_time" class="form-control" placeholder="Enter response time" disabled>
      <button class="btn btn-primary mt-2" id="takeResponseTimeTest">Take Response Time Test</button>
    </div>

    <button id="submitBtn" class="btn btn-success w-100">Submit & Predict</button>
    <div id="result" class="mt-4"></div>
  </div>

  <script>
    window.onload = function() {
      const tests = ["attention", "cognitive", "reading_speed", "spelling_accuracy", "writing_errors", "phonemic_errors", "response_time"];
      tests.forEach(test => {
        const value = sessionStorage.getItem(test + "_score");
        if (value) document.getElementById(test).value = value;
      });

      const tips = [
        "Tip: Use a quiet environment for better concentration during tests.",
        "Tip: Complete all tests in one session for more consistent results.",
        "Tip: Randomized questions reduce memorization bias in scoring."
      ];
      document.getElementById('randomTip').textContent = tips[Math.floor(Math.random() * tips.length)];
    };

    document.getElementById('takeAttentionTest').addEventListener('click', () => { window.location.href = "/attention_span_calculator.html"; });
    document.getElementById('takeCognitiveTest').addEventListener('click', () => { window.location.href = "/cognitive_score_test.html"; });
    document.getElementById('takeReadingSpeedTest').addEventListener('click', () => { window.location.href = "/reading_speed_test.html"; });
    document.getElementById('takeSpellingAccuracyTest').addEventListener('click', () => { window.location.href = "/spelling_accuracy_test.html"; });
    document.getElementById('takeWritingErrorsTest').addEventListener('click', () => { window.location.href = "/writing_errors_test.html"; });
    document.getElementById('takePhonemicErrorsTest').addEventListener('click', () => { window.location.href = "/phonemic_awareness_test.html"; });
    document.getElementById('takeResponseTimeTest').addEventListener('click', () => { window.location.href = "/response_time_test.html"; });

    document.getElementById('submitBtn').addEventListener('click', function() {
      const inputData = {
        Attention_Span: document.getElementById('attention').value,
        Cognitive_Score: document.getElementById('cognitive').value,
        Reading_Speed: document.getElementById('reading_speed').value,
        Spelling_Accuracy: document.getElementById('spelling_accuracy').value,
        Writing_Errors: document.getElementById('writing_errors').value,
        Phonemic_Awareness_Errors: document.getElementById('phonemic_errors').value,
        Response_Time: document.getElementById('response_time').value
      };

      fetch('http://127.0.0.1:5000/predict', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(inputData)
      })
      .then(response => {
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        return response.json();
      })
      .then(data => {
        if (data.prediction !== undefined) {
          const predictionScore = Number(data.prediction);
          const resultText = predictionScore >= 0.5 ? "High likelihood of dyslexia" : "Low likelihood of dyslexia";
          const redirectPath = data.result_redirect || '';
          if (redirectPath) {
            window.location.href = `http://127.0.0.1:5000${redirectPath}`;
            return;
          }
          document.getElementById('result').innerHTML = `<div class="alert alert-info">${resultText} (${(predictionScore*100).toFixed(2)}%)</div>`;
        } else {
          document.getElementById('result').innerHTML = `<div class="alert alert-danger">❌ Error: ${data.error || 'No prediction returned'}</div>`;
        }
      })
      .catch(error => {
        document.getElementById('result').innerHTML = `<div class="alert alert-danger">❌ Error: ${error.message}</div>`;
      });
    });
  </script>
</body>
</html>
